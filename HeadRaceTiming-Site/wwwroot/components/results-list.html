<link rel="import" href="/lib/polymer/polymer.html">
<link rel="import" href="/lib/iron-ajax/iron-ajax.html" />
<link rel="import" href="/components/iron-list.html" />
<link rel="import" href="/lib/iron-media-query/iron-media-query.html" />

<dom-module id="results-list">
    <template>
        <style>
            .header-row, .row {
                @apply(--layout-horizontal);
                line-height: 56px;
                padding-left: 24px;
                padding-right: 24px;
                border-bottom: 1px rgba(0, 0, 0, 0.12) solid;
            }

            .header-row {
                color: rgba(0,0,0,0.54);
            }

            .dataRow {
                @apply(--layout-horizontal);
                line-height: 48px;
                margin-bottom: 8px;
            }

            .item {
                @apply(--layout-flex);
            }

            .itemData {
                @apply(--layout-horizontal);
            }

            .row {
                color: rgba(0,0,0,0.87);
            }

            .row:hover {
                background-color: #eeeeee;
                cursor: pointer;
            }

            .startNumber {
                width: 50px;
                margin-right: 8px;
            }

            .name {
                @apply(--layout-flex);
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }

            .intermediate, .time {
                width: 100px;
                text-align: right;
            }

            .rank {
                width: 50px;
            }
        </style>

        <iron-ajax id="ajax" url$="/api/CrewApi/ByCompetition/[[competitionId]]/[[searchValue]]" last-response="{{data}}" on-response="updateData"></iron-ajax>
        <iron-media-query query="min-width: 600px" query-matches="{{wide}}"></iron-media-query>

        <div class="header-row">
            <div class="rank">Rank</div>
            <div class="startNumber">Start</div>
            <div class="name">Crew Name</div>
            <div hidden$="[[_logicalNand(showFirstIntermediate,wide)]]" class="intermediate">[[firstIntermediateName]]</div>
            <div hidden$="[[_logicalNand(showSecondIntermediate, wide)]]" class="intermediate">[[secondIntermediateName]]</div>
            <div class="time">Finish</div>
        </div>
        <iron-list scroll-target="document" items="[[data]]" as="item" id="crewsList">
            <template>
                <div>
                    <div class="row" data-crew-id="[[item.crewId]]" onclick="location.href='/Crew/Details/' + this.dataCrewId">
                        <div class="rank">
                            <template is="dom-if" if="{{item.overallTime}}">
                                [[item.rank]]
                            </template>
                        </div>
                        <div class="startNumber">
                            [[item.startNumber]]
                        </div>
                        <div class="name" title="[[item.name]]">
                            [[item.name]]
                        </div>
                        <div hidden$="[[_logicalNand(showFirstIntermediate,wide)]]" class="intermediate">
                            [[item.firstIntermediateTime]]
                            <template is="dom-if" if="{{item.firstIntermediateTime}}">
                                ([[item.firstIntermediateRank]])
                            </template>
                        </div>
                        <div hidden$="[[_logicalNand(showSecondIntermediate, wide)]]" class="intermediate">
                            [[item.secondIntermediateTime]]
                            <template is="dom-if" if="{{item.secondIntermediateTime}}">
                                ([[item.secondIntermediateRank]])
                            </template>
                        </div>
                        <div class="time">
                            [[item.overallTime]]
                        </div>
                    </div>
                </div>
            </template>
        </iron-list>
    </template>

    <script>
        class ResultsList extends Polymer.Element {

            static get is() { return 'results-list'; }

            static get properties() {
                return {
                    competitionId: Number,
                    firstIntermediateName: String,
                    secondIntermediateName: String,
                    showFirstIntermediate: Boolean,
                    showSecondIntermediate: Boolean,
                    searchValue: String,
                    data: Array
                };
            }

            updateData() {
                var ajaxElement = this.$.ajax;
                setTimeout(function () {
                    ajaxElement.generateRequest();
                }, 2000);
            }

            ready() {
                super.ready();
                Polymer.RenderStatus.afterNextRender(this, function () {
                    this.updateData();
                });
            }

            _logicalNand(a, b) {
                return !(a && b);
            }
        }

        customElements.define(ResultsList.is, ResultsList);
    </script>

</dom-module>