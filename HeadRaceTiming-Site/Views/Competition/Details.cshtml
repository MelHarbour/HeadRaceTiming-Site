@model HeadRaceTimingSite.Models.Competition
@{
    ViewData["Title"] = Model.Name;
    ViewData["TitleColor"] = Model.BackgroundHtmlColor;
}

@section imports {
    <link rel="import" href="~/components/results-list.html" />
    <link rel="import" href="~/lib/paper-dialog/paper-dialog.html" />
    <link rel="import" href="~/lib/app-route/app-location.html" />
    <link rel="import" href="~/components/app-route.html" />
}

@section titleBar{
    <div main-title>@ViewData["Title"]</div>
    <paper-icon-button icon="search" id="searchButton"></paper-icon-button>
    <paper-icon-button icon="cloud-download" id="downloadButton"></paper-icon-button>
    <paper-icon-button onclick="dialog.open()" icon="info" id="infoButton"></paper-icon-button>
    <paper-icon-button class="searchTools" icon="arrow-back" id="backButton"></paper-icon-button>
    <paper-input class="searchTools" id="searchBox" value="{{subrouteData.searchValue}}" no-label-float="true"></paper-input>
}

@section titleStyle{
    <style>
        app-header {
            background-color: #@ViewData["TitleColor"];
            color: #fff;
        }
    </style>
}

<app-location route="{{route}}"></app-location>
<app-route route="{{route}}" pattern="/Competition/Details/:page" data="{{data}}" tail="{{subroute}}"></app-route>
<app-route route="{{subroute}}" pattern="/:searchValue" data="{{subrouteData}}"></app-route>

<results-list competition-id="@Model.CompetitionId" first-intermediate-name="@Model.FirstIntermediateName" 
              second-intermediate-name="@Model.SecondIntermediateName" search-value="{{subrouteData.searchValue}}" 
              first-intermediate-id="@Model.FirstIntermediateId" second-intermediate-id="@Model.SecondIntermediateId"></results-list>

<paper-dialog id="dialog">
    <h2>Information</h2>
    <p>
        All the times on this page are provisional subject to any penalties being applied. Full results will be available from the
        <a href="http://www.wehorr.org">Women's Head of the River Race website</a> after racing has finished.
    </p>

    <p>Crew lists may not show recent substitutions as these do not update automatically. The data will be updated at close of substitutions on race day.</p>
</paper-dialog>

@section scripts {
    <script>
        window.addEventListener('WebComponentsReady', function (e) {
            document.querySelector("#searchButton").addEventListener("click", function (e) {
                $("#searchButton").css("display", "none");
                $("#downloadButton").css("display", "none");
                $("#infoButton").css("display", "none");
                $("#backButton").css("display", "block");
                $("#searchBox").css("display", "block");
                $("#searchBox").focus();
                $("[main-title]").css("display", "none");
            });
            document.querySelector("#backButton").addEventListener("click", function (e) {
                $("#searchButton").css("display", "inline-block");
                $("#downloadButton").css("display", "inline-block");
                $("#infoButton").css("display", "inline-block");
                $("#backButton").css("display", "none");
                $("#searchBox").css("display", "none");
                $("[main-title]").css("display", "block");
            });

            document.querySelector("#downloadButton").addEventListener("click", function (e) {
                location.href = '/Competition/DetailsAsCsv/@Model.CompetitionId'
            });
            document.getElementById("searchBox").addEventListener('value-changed', function () {
                var appRoute = document.getElementsByTagName('app-route')[0].route;
                if (appRoute.path.slice(-1) !== '/') {
                    appRoute.path = appRoute.path + '/';
                }
            });
        });
        $(window).scroll(function () {
            sessionStorage.scrollTop = $(this).scrollTop();
        });
        document.querySelector('results-list').addEventListener('update', function (e) {
            if (sessionStorage.scrollTop != "undefined") {
                $(window).scrollTop(sessionStorage.scrollTop);
            }
        });
        
    </script>
}